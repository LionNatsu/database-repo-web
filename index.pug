//
    Copyright (C) 2019 Daming Yang
    This program is free software, released under Server Side Public License.

    Please change index.pug and do not change index.html
    because index.html was generated by generate.sh.

doctype html
html
    head
        meta(charset='UTF-8')
        title Repository Database
        style(media='screen').
            #result {
                position: absolute;
                top: 0;
                right: 50%;
                bottom: 0;
                left: 0;
            }
            #editor {
                position: absolute;
                top: 0;
                right: 0;
                bottom: 5%;
                left: 50%;
            }
            #submit {
                background-color: orange;
                position: absolute;
                top: 95%;
                right: 0;
                bottom: 0;
                left: 50%;
                text-align: center;
            }
            #submit * {
                color: yellow;
            }
    body
        #form
            #result.
                The result shows here.
            #editor.
                #
                ## Exmaple
                - $sample:
                    size: 1
                
                ## ( Ctrl+/ to toggle comments )
                ## Example:
                # - $unwind: $so_depends
                # - $match:
                #     so_depends: {name: libmbedtls.so, ver: '.11'}
                # - $project:
                #     _id: 0
                #     pkg: {arch: 1, name: 1, ver: 1}
                
                ## The aggregation pipeline in YAML format.
                ## https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/
                
                ## Click the button below or press Ctrl+Enter to query.
                
                ## You may specify the branch to be query by adding a comment
                ## line at the first line of this editor. For example:
                
                # testing
                
                ## Only one branch is allowed. If no branch is specified,
                ## It defaults to "stable"
                
            #submit(onclick='do_submit()')
                span ask zaãƒ»database
        
        script(src='ace-builds-1.4.2/src-noconflict/ace.js')
        script(src='jquery-3.3.1.min.js')
        script.
            var result = ace.edit('result');
            result.setTheme('ace/theme/github');
            result.session.setMode('ace/mode/yaml');
            result.setReadOnly(true);
            var editor = ace.edit('editor');
            editor.setTheme('ace/theme/github');
            editor.session.setMode('ace/mode/yaml');
            function do_submit() {
                var query = editor.getValue();
                $.ajax({
                    url: '/cgi-bin/repo-query',
                    data: {'query': query},
                    dataType: 'text'
                })
                .done(function(c) {
                    result.setValue(c);
                    result.clearSelection();
                });
            }
            $('#editor').keydown(function(e) {
                if(e.ctrlKey && e.keyCode == 13) {
                    do_submit();
                }
            });
            $(document).ready(do_submit);
